# Use this Blueprint to deploy n8n on Render as a web
# service that uses an external Neon DB (PostgreSQL)
# to store workflow data permanently.

services:
  - type: web
    plan: free
    # This is the runtime for services that pull a prebuilt Docker image
    runtime: image
    # You can give the service any name
    name: n8n-service

    image:
      # Pulls the n8n image tagged as latest from Docker Hub
      url: docker.io/n8nio/n8n:latest

    # All environment variables defined below are required!
    envVars:
      # Generates a base64-encoded key for encrypting credentials in n8n
      # IMPORTANT: Do not modify this value after it's generated!
      - key: N8N_ENCRYPTION_KEY
        generateValue: true

      # --- VARIABLES MODIFIÉES POUR NEON DB ---
      
      # 1. Indique à n8n d'utiliser le pilote PostgreSQL standard
      - key: DB_TYPE
        value: postgres
      
      # 2. Variable attendue par n8n pour la chaîne de connexion complète.
      #    ATTENTION : Cette valeur DOIT être ajoutée manuellement sur Render
      #    après le déploiement, en utilisant l'URL de connexion de Neon.
      #    Laissez la valeur vide ici ou retirez la ligne 'value'
      #    si vous ajoutez la variable manuellement sur le dashboard Render.
      #
      #    Exemple de l'URL Neon:
      #    postgresql://[USER]:[PASSWORD]@[HOST].neonserver.cloud/neondb?sslmode=require
      - key: N8N_DB_POSTGRES_URL 
        value: "" # Laissez vide ou retirez cette ligne et ajoutez la variable dans le dashboard

      # --- Autres variables N8N recommandées ---
      - key: N8N_HOST
        # Ceci sera remplacé automatiquement par l'URL Render de votre service
        value: ${{{ env.RENDER_EXTERNAL_HOSTNAME }}}
      - key: N8N_PROTOCOL
        value: https
      - key: WEBHOOK_URL
        value: https://${{ env.N8N_HOST }}

# --- SECTION DATABASES SUPPRIMÉE ---
# La base de données Render n'est plus définie ici.
